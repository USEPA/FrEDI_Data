---
title: "Build the FrEDI R Package"
author: "Industrial Economics, Inc."
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  rmarkdown::html_document:
    theme: spacelab
    toc: true
    toc_float: true
---

<style>
/* Simplified version of Bootstrap's responsive table CSS */
.table-responsive {
    display: block;
    width: 100%;
    overflow-x: auto;
}

.table-responsive > table {
    width: 100%;
}
</style>


```{r knitr setup, include=FALSE}
### The following parameters declare the options for compiling the Markdown document.
knitr::opts_chunk$set(
  include = T,     ### Evaluate and depict outputs of code chunks in the compiled document
  echo    = T,     ### Echo the commands of the code chunks in the compiled document
  message = FALSE, ### Don't include command-line messages output from evaluating code chunks
  cache   = FALSE, ### Don't cache the evaluation of code chunks
  warning = FALSE,  ### Don't include warnings from evaluating code chunks
  table.format = "html" 
)
```

## Overview

The purpose of this package is to build the R package after configuration. First run "1_configure_FrEDI_main.Rmd" and "2_configure_FrEDI_SV.Rmd"  prior to running "3_build_FrEDI.Rmd".

Load packages 

```{r loadPackages}
### Packages
require(tidyverse)
require(openxlsx)
require(devtools)
```


Set paths

```{r declare paths}
### Set print options
options(digits = 20)
### Set system paths
# projectPath      <- getwd()
projectPath      <- "."
today            <- format(Sys.Date(), "%Y%m%d")

### Path to fredi project
projectParentDir <- projectPath %>% file.path("..")
projectParentDir %>% list.files
frediPath        <- projectParentDir %>% file.path("FrEDI")
```



## Update R Tool [#updateRtool]

### Update Default Outputs

Use the following section to update R defaults

```{r defaultResults}
# ###### Update and Save Default Scenario ######
frediPath %>% load_all
defaultResults <- run_fredi()
save(defaultResults, file=frediPath %>% file.path("data", "defaultResults.rda"))
```



### Update Documentation

Use the following code to update documentation
<!-- usethis::use_data() -->

```{r datasets to include}
# usethis::use_data_raw()
```


Issues with building the package:

* https://community.rstudio.com/t/r-version-4-2-2-devtools-build-manual-fails/154217/6
* Probably need LaTeX to build manual

```{r updateDocs}
###### Update Documentation ######
###### - Build Manual
###### - Add and build vignettes
###### - Generate Documentation
roxygen2::roxygenise(frediPath)
devtools::document(pkg = frediPath)
# devtools::build_manual(pkg = frediPath)
# devtools::build_vignettes(pkg = frediPath)
```



### Build the Package

Use the following code to build the package

```{r bldPackage}
###### Build Package ######
###### - Build Package but don't include vignettes
devtools::build(pkg=frediPath, path=projectParentDir)
```



### Copy Package Build to Library


Most recent version of the model:

```{r newVersionNum}
packageName     <- "FrEDI"
packageVersion  <- packageName %>% packageVersion(); packageVersion
packageFileName <- packageName %>% paste0("_", packageVersion, ".tar.gz"); packageFileName
```

Copy to a new folder

```{r package paths}
### Copy the file
# packageFilePath <- frediPath %>% file.path("..", packageFileName)
packageFilePath <- projectParentDir %>% file.path(packageFileName)
packageLibrary  <- .libPaths()[1]
packageDestPath <- packageLibrary %>% file.path(packageFileName)
### Copy file
file.copy(from = packageFilePath, to = packageLibrary, overwrite = T)
```



## Install FrEDI


Restart R and any sessions that have FrEDI loaded using the command `Ctrl+Shift+F10`. Then run "4_install_FrEDI.Rmd".

